<html>

<head>

    <title>osc</title>
</head>

<body>

    <input type="button" value="start" id="start" data-id="" />
    <input type="button" value="stop" id="stop" data-id="" /> Hertz: <label id="hertz-value"></label>
    <input id="hertz" min="0" max="20000" step="10" type="range" value="0"> Gain: <label id="gain-value"></label>
    <input id="gain" min="0" max="10000" step="10" type="range" value="100">
    <select id="freq">
    <option value="sine">sine</option>
    <option value="square">square</option>
    <option value="sawtooth">sawtooth</option>
    <option value="triangle">triangle</option>
    <option value="custom">custom</option>
</select>
</body>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"></script>
<script type="text/javascript">
    // get audio
    
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    var id = 0;
    function oscillator() {
        var oscillator = audioCtx.createOscillator();
        var gainNode = audioCtx.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        return {
            osc: oscillator,
            gain: gainNode,
            id: ++id
        }
    }
    
    function step(power) {
        return Math.pow(440 * (1.059463094359), power);
    }

    function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    $(document).ready(function () {

        $("#hertz").change(function () {
            $("#hertz-value").text(this.value);
            window.osc.frequency.value = parseInt(this.value); // value in hertz
        });

        $("#freq").change(function() {
            console.log(this.value);
            window.osc.type = this.value; // sine wave â€” other values are 'square', 'sawtooth', 'triangle' and 'custom'
        });

        $("#start").click(function () {
            /*var i = 0;
            setInterval(function() {
                if (i % 2 == 0) {
                    g3(oscillator()).start();
                } 
                else {
                    e3(oscillator()).start();
                }
            }, 500);*/

            playInterval();
        });

        $("#stop").click(function () {
            
        });

        function playInterval() {
            // Random number from 0 to 12
            // Math.pow(440 * (1.059463094359), random);

            // Instance of osc for random note #1
            // Set timeout
                // Set another timeout for second note

            function randomNote() {
                var rando = Math.floor(Math.random() * 12) + 1;
                // 440 is a4
                return 440 * Math.pow(1.059463094359, rando); 
            }

            setTimeout(function () {
                // First note played
                var osc1 = oscillator().osc;
                osc1.frequency.value = randomNote();
                osc1.start();

                setTimeout(function () {
                    // Turn off first note
                    osc1.stop();

                    sleep(1500).then(() => {
                        // Do something after the sleep!
                        var osc2 = oscillator().osc;
                        osc2.frequency.value = randomNote();
                        osc2.start();

                        setTimeout(function () {
                            osc2.stop();
                        }, 1500);
                    })
                }, 2000);
            }, 500)
        }

        function g3(obj) {
            obj.osc.frequency.value = 196.0;
            obj.osc.type = 'sawtooth';
            //obj.gain.gain.value = 100;
            return obj.osc;
        }

        function e3(obj) {
            obj.osc.frequency.value = 164.81;
            obj.osc.type = 'sine';
            //obj.gain.gain.value = 100;
            return obj.osc;            
        }

        function c3(obj) {
            obj.osc.frequency.value = 130.81;
            obj.osc.type = 'sine';
            //obj.gain.gain.value = 100;
            return obj.osc;
        }

        function randomize(type) {
            window.osc.frequency.value = parseInt(Math.floor(Math.random() * 440) + 100);
            window.osc.type = type || {
                1: 'sine',
                2: 'square',
                3: 'sawtooth',
                4: 'triangle',
                5: 'custom'
            }[Math.floor(Math.random() * 4) + 1];
        };
        

       
    });

</script>

</html>