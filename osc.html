<html>

<head>

    <title>Not�mon</title>

    <link href='css/style.min.css' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,  400,600,800' rel='stylesheet' type='text/css'>
    <link href='css/font-awesome.min.css' rel='stylesheet' type='text/css'>
    <link href='css/animate.css' rel='stylesheet' type='text/css'>
</head>

<body>

    <!--<input type="button" value="start" id="start" data-id="" />
    <input type="button" value="stop" id="stop" data-id="" /> Hertz: <label id="hertz-value"></label>
    <input id="hertz" min="0" max="20000" step="10" type="range" value="0"> Gain: <label id="gain-value"></label>
    <input id="gain" min="0" max="10000" step="10" type="range" value="100">
    <select id="freq">
        <option value="sine">sine</option>
        <option value="square">square</option>
        <option value="sawtooth">sawtooth</option>
        <option value="triangle">triangle</option>
        <option value="custom">custom</option>
    </select>-->

    <header>
        Not�mon
    </header>

    <div id="interval-container">
        <div class="header">
            <!-- Animations -->
            <div class="success-indicator ani-success-fade-gradient"></div> <!-- Animated gradient -->
            <div class="ani-success-circle"></div> <!-- Animated circle -->

            <div class="content">
                <i class="fa fa-music animated" aria-hidden="true"></i>
                <p class="status">
                    Click to start
                </p>
            </div>
        </div>

        <div id="options">
            <div class="btn minor" data-steps="1">2nd</div>
            <div class="btn major end" data-steps="2">2nd</div>

            <div class="btn minor" data-steps="3">3rd</div>
            <div class="btn major end" data-steps="4">3rd</div>

            <div class="btn" data-steps="5">4th</div>
            <div class="btn augmented end" data-steps="6">4th</div>

            <div class="btn btn-wide" data-steps="7">5th</div>

            <div class="btn minor" data-steps="8">6th</div>
            <div class="btn major end" data-steps="9">6th</div>

            <div class="btn minor" data-steps="10">7th</div>
            <div class="btn major end" data-steps="11">7th</div>

            <div class="btn btn bottom" data-steps="0">Unison</div>
            <div class="btn btn end bottom" data-steps="12">Octave</div>

            <div style="clear: both"></div>
        </div>
    </div>

    <button class="successs" type="button" style="position: absolute; top: 0;">success</button>
</body>
<script src="oscillator.js" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script type="text/javascript">
    // get audio
    
    var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    var id = 0;
    function oscillator() {
        var oscillator = audioCtx.createOscillator();
        var gainNode = audioCtx.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        return {
            osc: oscillator,
            gain: gainNode,
            id: ++id
        }
    }
    
    function step(power) {
        return Math.pow(440 * (1.059463094359), power);
    }

    function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    $(document).ready(function () {

        $("#hertz").change(function () {
            $("#hertz-value").text(this.value);
            window.osc.frequency.value = parseInt(this.value); // value in hertz
        });

        $("#freq").change(function() {
            console.log(this.value);
            window.osc.type = this.value; // sine wave � other values are 'square', 'sawtooth', 'triangle' and 'custom'
        });

        $("#start").click(function () {
            playInterval();
        });

        $("#stop").click(function () {
            
        });

        $("#interval-container .header").click(function () {
            playInterval();
            $("#interval-container p").hide();
        });

        $("#interval-container .btn").click(function () {
            var userAnswer = $(this).data("steps");
            var correctAnswer = Math.abs(window.firstStep - window.secondStep); // Always make positive number
            runSuccessAnimation();
            $("#interval-container .status").text("Correct!").show();return;

            if (userAnswer == correctAnswer) {
                $("#interval-container .status").text("Correct!").show();
            } else {
                $("#interval-container .status").text("Wrong :(").show();
            }
            $(".success-indicator").toggleClass("success");
        });

        function runSuccessAnimation() {
            var fadeAni = $(".ani-success-fade-gradient"),
            circleAni =  $(".ani-success-circle");

            resetAnimation(fadeAni);
            resetAnimation(circleAni);

            /* Note bounce ani */
            setTimeout(function () {
                var $musicNote = $(".fa-music");
                $musicNote.addClass("bounce");

                var el = $musicNote,  
                newone = el.clone(true);
                       
                el.before(newone);
                    
                el.remove();
            });

            var $text = $("#interval-container .status").text("Correct!").addClass("ani-success-text-blink");
            resetAnimation($text);
        }

        function resetAnimation(object) {
            var el = object,
            clone = el.clone(true);
                   
            el.before(clone);
            el.remove();
            clone.show();
        }

        function playInterval() {
            // Random number from 0 to 12
            // Math.pow(440 * (1.059463094359), random);

            // Instance of osc for random note #1
            // Set timeout
                // Set another timeout for second note
            
            /*
                var mgr = oscManager();

                mgr.wait(333)
                   .oscillator()
                   .randomNote()
                   .start()
                   .wait(1333)
                   .stop()
                   .sleep(1333)
                   .oscillator()
                   .randomNote()
                   .start()
                   .wait(1333)
                   .stop();

            */

            window.rootNote = 440; // a4
            window.firstStep = 0;
            window.secondStep = 0;

            function randomNote(order) {
                var rando = Math.floor(Math.random() * 12) + 1;

                if (order == "first") {
                    firstStep = rando;
                } else {
                    secondStep = rando;
                }
                // 440 is a4
                return rootNote * Math.pow(1.059463094359, rando); 
            }

            setTimeout(function () {
                // First note played
                var osc1 = oscillator().osc;
                osc1.frequency.value = randomNote("first");
                osc1.start();
                $(".fa-music").addClass("tada");

                setTimeout(function () {
                    // Turn off first note
                    osc1.stop();
                    $(".fa-music").removeClass("tada");

                    sleep(1333).then(() => {
                        // Play second note
                        var osc2 = oscillator().osc;
                        osc2.frequency.value = randomNote("second");
                        osc2.start();
                        $(".fa-music").addClass("tada");

                        // Stop second note
                        setTimeout(function () {
                            osc2.stop();
                            $(".fa-music").removeClass("tada");
                        }, 1333);
                    })
                }, 1333);
            }, 333)
        }

        function g3(obj) {
            obj.osc.frequency.value = 196.0;
            obj.osc.type = 'sawtooth';
            //obj.gain.gain.value = 100;
            return obj.osc;
        }

        function e3(obj) {
            obj.osc.frequency.value = 164.81;
            obj.osc.type = 'sine';
            //obj.gain.gain.value = 100;
            return obj.osc;            
        }

        function c3(obj) {
            obj.osc.frequency.value = 130.81;
            obj.osc.type = 'sine';
            //obj.gain.gain.value = 100;
            return obj.osc;
        }

        function randomize(type) {
            window.osc.frequency.value = parseInt(Math.floor(Math.random() * 440) + 100);
            window.osc.type = type || {
                1: 'sine',
                2: 'square',
                3: 'sawtooth',
                4: 'triangle',
                5: 'custom'
            }[Math.floor(Math.random() * 4) + 1];
        };
        

       
    });

</script>

</html>